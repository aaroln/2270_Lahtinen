<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CODE2270 - 2022 BIM INTERFACE</title>
    <meta
        name="viewport"
        content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
  <link rel="stylesheet" href="css/style.css">

</head>

<body>

<script src="https://sdk.amazonaws.com/js/aws-sdk-2.1223.0.js"></script>
<script src="/loadS3.js"></script>
<script>listFiles();</script>
<script src="/js/three.js"></script>
<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.138.3/build/three.module.js"
        }
    }
</script>

<div class="titleBlock">
  <h1>UNSW CODE2270 BIM INTERFACE</h1>
  <h2>Aaro Lahtinen</h2>
</div>

<div class="canvas">
    <div id="frame"></div>
    <script type="module">

    import * as THREE from 'three';
    import { OrbitControls } from 'https://unpkg.com/three@0.138.3/examples/jsm/controls/OrbitControls.js';
    import { IFCLoader } from 'https://unpkg.com/three@0.138.3/examples/jsm/loaders/IFCLoader.js';

    // Getting dimensions of div ID "frame"
    let box = document.querySelector('.canvas');
    let width = box.clientWidth;
    let height = box.clientHeight
    const container = document.getElementById('frame');

    // let scene, camera, renderer;

    // Scene setup
    const scene = new THREE.Scene();

    const camera = new THREE.PerspectiveCamera( 60, width / height, 1, 10000 );

    // Renderer
    const renderer = new THREE.WebGLRenderer( { antialias: true } );
    renderer.setPixelRatio ( window.devicePixelRatio );
    renderer.setSize( width, height );
    container.appendChild( renderer.domElement )

    // Setup IFC Loader
    const ifcLoader = new IFCLoader();
    ifcLoader.ifcManager.setWasmPath('./model/');
    ifcLoader.load('model/checker.ifc', function (model) {

        scene.add(model.mesh);
        render();

    });

    // Scene
    scene.background = new THREE.Color('lightgrey')
    camera.position.set( 1, 1, 3 );

    // Lights
    const directionalLight1 = new THREE.DirectionalLight('white', 0.8);
    directionalLight1.position.set(1, 1, 1);
    scene.add(directionalLight1);

    const directionalLight2 = new THREE.DirectionalLight('white', 0.8);
    directionalLight2.position.set(-1, 0.5, -1);
    scene.add(directionalLight2);

    const ambientLight = new THREE.AmbientLight('white', 0.25);
    scene.add(ambientLight);

    //Control
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.update();

    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
    }
    animate();

   // init();

    // function init() {

      // Scene
      // scene = new THREE.Scene();
      // scene.background = new THREE.Color('lightgrey');

      // Camera
      //camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
      //camera.position.z = 0;
      //camera.position.y = 20;
      //camera.position.x = 20;

      // Lights
      //const directionalLight1 = new THREE.DirectionalLight('white', 0.8);
      //directionalLight1.position.set(1, 1, 1);
      //scene.add(directionalLight1);

      //const directionalLight2 = new THREE.DirectionalLight('white', 0.8);
      //directionalLight2.position.set(-1, 0.5, -1);
      //scene.add(directionalLight2);

      //const ambientLight = new THREE.AmbientLight('white', 0.25);
      //scene.add(ambientLight);

      // Setup IFC Loader
      //const ifcLoader = new IFCLoader();
      //ifcLoader.ifcManager.setWasmPath('./model/');
      //ifcLoader.load('model/checker.ifc', function (model) {

        //scene.add(model.mesh);
        //render();

      //});

      //const highlightMaterial = new THREE.MeshPhongMaterial({
        // color: 'blue',
        //depthTest: false,
        //transparent: true,
        //opacity: 0.5
      //});

      //function selectObject(event) {

        //if (event.button != 0) return;

        //const mouse = new THREE.Vector2();
        //mouse.x = (event.clientX / width) * 2 - 1;
        //mouse.y = -(event.clientY / height) * 2 + 1;

        //const raycaster = new THREE.Raycaster();
        //raycaster.setFromCamera(mouse, camera);

        //const intersected = raycaster.intersectObjects(scene.children, false);
        //if (intersected.length) {

          //const found = intersected[0];
          //const faceIndex = found.faceIndex;
          //const geometry = found.object.geometry;
          //const id = ifcLoader.ifcManager.getExpressId(geometry, faceIndex);

          //const modelID = found.object.modelID;
          //ifcLoader.ifcManager.createSubset({
            //modelID,
            //ids: [id],
            //scene,
            //removePrevious: true,
            //material: highlightMaterial
          //});
          //const props = ifcLoader.ifcManager.getItemProperties(modelID, id, true);
          //console.log(props);
          //renderer.render(scene, camera);

        //}

      //}

      //window.onpointerdown = selectObject;

      // Renderer
      //renderer = new THREE.WebGLRenderer({antialias: true});
      //renderer.setPixelRatio(window.devicePixelRatio);
      //renderer.setSize(width, height);
      //document.body.appendChild(renderer.domElement);

      // Controls
      //const controls = new OrbitControls(camera, renderer.domElement);
      //controls.addEventListener('change', render);

      //window.addEventListener('resize', onWindowResize);

      //render();

    //}

    //function onWindowResize() {

      //camera.aspect = width / height;
      //camera.updateProjectionMatrix();
      //renderer.setSize( width, height);

      //render();

    //}

    //function render() {

      //renderer.render( scene, camera);

    //}

    </script>
</div>

</body>
</html>